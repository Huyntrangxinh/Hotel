@using HotelBooking.ViewModels
@model PropertyPaymentViewModel
@{
    ViewData["Title"] = "Thông tin thanh toán";
}
<link rel="stylesheet" href="~/css/site.css" />

<section class="tera-form py-4">
    <div class="container-xxl" style="max-width:1120px">
        <div class="row g-4">

            <!-- Sidebar -->
            <aside class="col-lg-3">
                <div class="step-nav card card-slim sticky-top" style="top:12px;">
                    <div class="card-body p-0">
                        <div class="step-title">Tổng quan về cơ sở lưu trú</div>
                        <ul class="wizard-steps">
                            <li><a href="@Url.Action("Onboarding", "Partner", new { propertyId = Model.PropertyId })">Thông
                                    tin về cơ sở lưu trú</a></li>
                            <li><a href="@Url.Action("Onboarding", "Partner", new { propertyId = Model.PropertyId })">Địa
                                    chỉ cơ sở lưu trú</a></li>
                            <li><a href="@Url.Action("Onboarding", "Partner", new { propertyId = Model.PropertyId })">Thông
                                    tin liên hệ với cơ sở lưu trú</a></li>
                        </ul>
                        <div class="step-title">Thanh toán</div>
                        <ul class="wizard-steps">
                            <li class="active"><a href="#payment-section">Thanh toán</a></li>
                        </ul>
                        <div class="step-title">Hợp đồng</div>
                        <ul class="wizard-steps">
                            <li><a href="@Url.Action("Contract", "Partner", new { propertyId = Model.PropertyId })">Hợp
                                    đồng</a></li>
                        </ul>
                    </div>
                </div>
            </aside>

            <!-- Content -->
            <div class="col-lg-9">
                <form asp-action="Payment" method="post">
                    @Html.AntiForgeryToken()
                    <input type="hidden" asp-for="PropertyId" />

                    <!-- Phương thức thanh toán -->
                    <div id="payment-section" class="panel mb-4">
                        <div class="panel-body">
                            <h5 class="panel-title">Phương thức thanh toán</h5>

                            <div class="mb-3 fw-semibold">Bạn muốn nhận thanh toán như thế nào?</div>
                            <div class="d-flex gap-4 flex-wrap">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" asp-for="PaymentMethod"
                                        value="@PaymentMethodType.Card" id="payCard" />
                                    <label class="form-check-label" for="payCard">Mastercard VCC</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" asp-for="PaymentMethod"
                                        value="@PaymentMethodType.BankTransfer" id="payBank" />
                                    <label class="form-check-label" for="payBank">Chuyển khoản ngân hàng</label>
                                </div>
                            </div>
                            <span asp-validation-for="PaymentMethod" class="text-danger small"></span>

                            <!-- box mô tả giống ảnh -->
                            <div class="info-box mt-3">
                                <div class="small text-muted">
                                    Bạn có thể tính phí thanh toán cho nhiều Mã đặt chỗ bằng VCC của Traveloka.
                                </div>
                            </div>

                            <!-- Ngân hàng (ẩn/hiện) -->
                            <div id="bankDetailsSection" class="mt-4" style="display:none;">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label asp-for="BankName" class="form-label"></label>
                                        <select asp-for="BankName" class="form-select form-select-sm">
                                            <option value="">Chọn ngân hàng</option>
                                            <option value="Vietcombank">Vietcombank</option>
                                            <option value="Techcombank">Techcombank</option>
                                            <option value="ACB">ACB</option>
                                        </select>
                                        <span asp-validation-for="BankName" class="text-danger small"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label asp-for="BankBranch" class="form-label"></label>
                                        <input asp-for="BankBranch" class="form-control form-control-sm" />
                                        <span asp-validation-for="BankBranch" class="text-danger small"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label asp-for="BankAccountNumber" class="form-label"></label>
                                        <input asp-for="BankAccountNumber" class="form-control form-control-sm" />
                                        <span asp-validation-for="BankAccountNumber" class="text-danger small"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label asp-for="BankAccountHolderName" class="form-label"></label>
                                        <input asp-for="BankAccountHolderName" class="form-control form-control-sm" />
                                        <span asp-validation-for="BankAccountHolderName"
                                            class="text-danger small"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Thanh toán tại khách sạn -->
                    <div class="panel mb-5">
                        <div class="panel-body">
                            <h5 class="panel-title">Thanh toán tại khách sạn</h5>
                            <div class="mb-2">Bạn có muốn bật Thanh toán tại khách sạn không?</div>
                            <div class="d-flex gap-4 flex-wrap">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" asp-for="AllowPaymentAtHotel"
                                        id="allowYes" value="true">
                                    <label class="form-check-label" for="allowYes">Có</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" asp-for="AllowPaymentAtHotel"
                                        id="allowNo" value="false">
                                    <label class="form-check-label" for="allowNo">Không</label>
                                </div>
                            </div>
                            <span asp-validation-for="AllowPaymentAtHotel" class="text-danger small"></span>

                            <!-- alert note giống ảnh -->
                            <div class="alert alert-soft mt-3">
                                <div class="d-flex">
                                    <i class="bi bi-info-circle me-2"></i>
                                    <div class="small">
                                        Nếu bật Thanh toán tại khách sạn, hình thức thanh toán hoá hồng của bạn cho
                                        Traveloka sẽ được cài đặt là Hóa đơn theo mặc định.
                                        Bạn có thể thay đổi cài đặt này sau trong TERA.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sticky footer -->
                    <div class="onb-sticky">
                        <div class="d-flex justify-content-between">
                            <a asp-action="Onboarding" asp-route-propertyId="@Model.PropertyId"
                                class="btn btn-outline-secondary btn-sm">Quay lại trang trước</a>
                            <button type="submit" class="btn btn-warning btn-sm px-4">Lưu và tiếp tục</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const bankRadio = document.getElementById('payBank');
            const cardRadio = document.getElementById('payCard');
            const bankDetailsSection = document.getElementById('bankDetailsSection');
            function toggleBankDetails() { bankDetailsSection.style.display = bankRadio.checked ? 'block' : 'none'; }
            bankRadio.addEventListener('change', toggleBankDetails);
            cardRadio.addEventListener('change', toggleBankDetails);
            toggleBankDetails();
        });
    </script>
}

<style>
    /* ====== Compact Traveloka-like look ====== */
    .tera-form {
        font-size: 14px
    }

    /* Panel styling */
    .panel {
        border: 1px solid #e7edf8;
        border-radius: 14px;
        background: #fff;
        box-shadow: 0 1px 0 rgba(16, 24, 40, .04)
    }

    .panel-body {
        padding: 18px
    }

    .panel-title {
        margin-bottom: 12px;
        font-weight: 600
    }

    .form-control.form-control-sm,
    .form-select.form-select-sm {
        height: 40px;
        padding: .35rem .75rem;
        border-radius: 10px;
        border-color: #d7e0f1;
        font-size: 14px
    }

    .form-control:focus,
    .form-select:focus {
        box-shadow: 0 0 0 .2rem rgba(13, 110, 253, .12);
        border-color: #9bbcff
    }

    /* ===== Sidebar (giống Onboarding) ===== */
    .step-nav.card {
        border: none;
        background: transparent;
        box-shadow: none;
    }

    .step-nav .card-body {
        padding: 0;
    }

    /* Header nhóm dạng "pill" + chevron */
    .step-title {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 16px;
        margin: 0 0 10px 0;
        background: #fff;
        border: 1px solid #eef1f5;
        border-radius: 28px;
        font-weight: 700;
        color: #111827;
        box-shadow: 0 2px 8px rgba(13, 110, 253, .06);
    }

    .step-title::after {
        content: "";
        width: 16px;
        height: 16px;
        flex: 0 0 16px;
        background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'><path fill='%236c757d' d='M6 3l5 5-5 5z'/></svg>");
        background-size: 16px 16px;
        background-repeat: no-repeat;
        background-position: center;
    }

    .wizard-steps {
        list-style: none;
        margin: 0 0 12px 0;
        padding: .25rem 0 .75rem 12px;
    }

    .wizard-steps li {
        padding: .4rem 1rem;
        border-left: 3px solid transparent;
        border-radius: 10px;
    }

    .wizard-steps li:hover {
        background: #f6f8fb;
    }

    .wizard-steps a {
        text-decoration: none;
        color: #495057;
        display: block;
    }

    /* Mục đang active: chữ xanh + vạch xanh bên trái */
    .wizard-steps li.active {
        background: #f8f9fb;
        border-left-color: #0d6efd;
    }

    .wizard-steps li.active a {
        color: #0d6efd;
        font-weight: 600;
    }

    /* info + alert boxes */
    .info-box {
        border: 1px solid #e7edf8;
        background: #f9fbff;
        border-radius: 10px;
        padding: .6rem .75rem
    }

    .alert-soft {
        border: 1px solid #d7e8ff;
        background: #eef5ff;
        border-radius: 10px;
        padding: .6rem .75rem
    }

    /* sticky footer */
    .onb-sticky {
        position: sticky;
        bottom: 0;
        background: #fff;
        border-top: 1px solid #e9ecef;
        padding: 10px 0;
        z-index: 50;
        box-shadow: 0 -2px 8px rgba(16, 24, 40, .05)
    }

    .btn.btn-warning.btn-sm,
    .btn-outline-secondary.btn-sm {
        border-radius: 10px
    }
</style>
